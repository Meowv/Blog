---
title: Scrapy-Redisåˆ†å¸ƒå¼çˆ¬è™«
author: é˜¿æ˜Ÿğ‘·ğ’ğ’–ğ’”
date: 2019-07-17 20:19:00
categories: Python
tags:
  - Scrapy
  - redis
  - çˆ¬è™«
---

## Scrapy-Redis åˆ†å¸ƒå¼çˆ¬è™«ç»„ä»¶

Scrapy æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œä»–æœ¬èº«æ˜¯ä¸æ”¯æŒåˆ†å¸ƒå¼çš„ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦åšåˆ†å¸ƒå¼çš„çˆ¬è™«ï¼Œå°±éœ€è¦å€ŸåŠ©ä¸€ä¸ªç»„ä»¶å«åš Scrapy-Redisï¼Œè¿™ä¸ªç»„ä»¶æ­£æ˜¯åˆ©ç”¨äº† Redis å¯ä»¥åˆ†å¸ƒå¼çš„åŠŸèƒ½ï¼Œé›†æˆåˆ° Scrapy æ¡†æ¶ä¸­ï¼Œä½¿å¾—çˆ¬è™«å¯ä»¥è¿›è¡Œåˆ†å¸ƒå¼ã€‚å¯ä»¥å……åˆ†çš„åˆ©ç”¨èµ„æºï¼ˆå¤šä¸ª ipã€æ›´å¤šå¸¦å®½ã€åŒæ­¥çˆ¬å–ï¼‰æ¥æé«˜çˆ¬è™«çš„çˆ¬è¡Œæ•ˆç‡ã€‚

## åˆ†å¸ƒå¼çˆ¬è™«çš„ä¼˜ç‚¹

- å¯ä»¥å……åˆ†åˆ©ç”¨å¤šå°æœºå™¨çš„å¸¦å®½
- å¯ä»¥å……åˆ†åˆ©ç”¨å¤šå°æœºå™¨çš„ ip åœ°å€
- å¤šå°æœºå™¨åšï¼Œçˆ¬å–æ•ˆç‡æ›´é«˜

## åˆ†å¸ƒå¼çˆ¬è™«å¿…é¡»è¦è§£å†³çš„é—®é¢˜

- åˆ†å¸ƒå¼çˆ¬è™«æ˜¯å¥½å‡ å°æœºå™¨åœ¨åŒæ—¶è¿è¡Œï¼Œå¦‚ä½•ä¿è¯ä¸åŒçš„æœºå™¨çˆ¬å–é¡µé¢çš„æ—¶å€™ä¸ä¼šå‡ºç°é‡å¤çˆ¬å–çš„é—®é¢˜
- åˆ†å¸ƒå¼çˆ¬è™«åœ¨ä¸åŒçš„æœºå™¨ä¸Šè¿è¡Œï¼Œåœ¨æŠŠæ•°æ®çˆ¬å®Œåå¦‚ä½•ä¿è¯ä¿å­˜åœ¨åŒä¸€ä¸ªåœ°æ–¹

## å®‰è£…

é€šè¿‡ `pip install scrapy-redis` å³å¯å®‰è£…

## å°† scrapy æ¡†æ¶å¼€å‘çš„çˆ¬è™«é¡¹ç›®æ”¹ä¸ºåˆ†å¸ƒå¼çˆ¬è™«é¡¹ç›®

1. å°†çˆ¬è™«çš„ç±»ä»`scrapy.Spider`å˜æˆ`scrapy_redis.spiders.RedisSpider`ï¼Œæˆ–è€…æ˜¯ä»`scrapy.CrawlSpider`å˜æˆ`scrapy_redis.spiders.RedisCrawlSpider`
2. å°†çˆ¬è™«ä¸­çš„`start_urls`åˆ æ‰ï¼Œå¢åŠ ä¸€ä¸ª `redis_key="xxx"` ã€‚è¿™ä¸ª`redis_key`æ˜¯ä¸ºäº†ä»¥ååœ¨ redis ä¸­æ§åˆ¶çˆ¬è™«å¯åŠ¨çš„ã€‚çˆ¬è™«çš„ç¬¬ä¸€ä¸ª urlï¼Œå°±æ˜¯åœ¨ redis ä¸­é€šè¿‡è¿™ä¸ªå‘é€å‡ºå»çš„ã€‚
3. åœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ å¦‚ä¸‹é…ç½®

   ```python
        # Scrapy-Redisç›¸å…³é…ç½®

        # ç¡®ä¿requestå­˜å‚¨åˆ°redisä¸­
        SCHEDULER = "scrapy_redis.scheduler.Scheduler"

        # ç¡®ä¿æ‰€æœ‰çˆ¬è™«å…±äº«ç›¸åŒçš„å»é‡æŒ‡çº¹
        DUPEFILTER_CLASS = "scrapy_redis.dupefilter.RFPDupeFilter"

        # è®¾ç½®redisä¸ºitem pipeline
        ITEM_PIPELINES = {
            'scrapy_redis.pipelines.RedisPipeline': 300
        }

        # åœ¨redisä¸­ä¿æŒscrapy-redisç”¨åˆ°çš„é˜Ÿåˆ—ï¼Œä¸ä¼šæ¸…ç†redisä¸­çš„é˜Ÿåˆ—ï¼Œä»è€Œå¯ä»¥å®ç°æš‚åœå’Œæ¢å¤çš„åŠŸèƒ½
        SCHEDULER_PERSIST = True

        # è®¾ç½®è¿æ¥redisä¿¡æ¯
        REDIS_HOST = '127.0.0.1'
        REDIS_PORT = 6379
   ```

4. è¿è¡Œçˆ¬è™«
   - åœ¨çˆ¬è™«æœåŠ¡å™¨ä¸Šï¼Œè¿›å…¥çˆ¬è™«æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ï¼Œç„¶åè¾“å…¥å‘½ä»¤ï¼š`scrapy runspider [çˆ¬è™«åå­—]`
   - åœ¨ Redis æœåŠ¡å™¨ä¸Šï¼Œæ¨å…¥ä¸€ä¸ªå¼€å§‹çš„ url é“¾æ¥ï¼š`redis-cli> lpush [redis_key] start_url` å¼€å§‹çˆ¬å–
