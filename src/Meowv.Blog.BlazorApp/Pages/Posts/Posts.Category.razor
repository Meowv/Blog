@page "/category/{name}"

@if (posts == null)
{
    <Loading />
}
else
{
    <div class="post-wrap tags">
        @if (categoryName != null)
        {
            <h2 class="post-title">-&nbsp;Category&nbsp;·&nbsp;@categoryName&nbsp;-</h2>
        }
    </div>
    <div class="post-wrap archive">
        @if (posts.Success && posts.Result.Any())
        {
            @foreach (var item in posts.Result)
            {
                <h3>@item.Year</h3>
                @foreach (var post in item.Posts)
                {
                    <article class="archive-item">
                        <NavLink href="@("/post"+post.Url)">@post.Title</NavLink>
                        <span class="archive-item-date">@post.CreationTime</span>
                    </article>
                }
            }
        }
        else
        {
            <ErrorTip />
        }
    </div>
}

@code {
    /// <summary>
    /// 分类名称参数
    /// </summary>
    [Parameter]
    public string name { get; set; }

    /// <summary>
    /// 分类名称
    /// </summary>
    private string categoryName;

    /// <summary>
    /// 文章列表数据
    /// </summary>
    private ServiceResult<IEnumerable<QueryPostDto>> posts;

    /// <summary>
    /// 初始化
    /// </summary>
    protected override async Task OnInitializedAsync()
    {
        // TODO:获取数据,可以在API中合并这两个请求。
        var category = await Http.GetFromJsonAsync<ServiceResult<string>>($"/blog/category?name={name}");
        posts = await Http.GetFromJsonAsync<ServiceResult<IEnumerable<QueryPostDto>>>($"/blog/posts/category?name={name}");

        if (category.Success)
        {
            categoryName = category.Result;

            await Common.SetTitleAsync(categoryName);
        }
    }
}